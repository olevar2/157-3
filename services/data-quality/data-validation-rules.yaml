# Data Quality Framework - Validation Rules Configuration
# Comprehensive validation rules for AI Forex Trading Platform
# Optimized for short-term trading data integrity (M1-H4 timeframes)

version: "1.0"
framework: "data-quality-v1"
last_updated: "2024-12-19"

# =============================================================================
# MARKET DATA VALIDATION RULES - CRITICAL FOR TRADING ACCURACY
# =============================================================================

market_data:
  price_validation:
    # Price data integrity checks for M1-H4 timeframes
    ohlc_consistency:
      rule_id: "MD001"
      description: "OHLC price consistency validation"
      severity: "CRITICAL"
      checks:
        - name: "high_low_range"
          condition: "high >= low"
          error_message: "High price must be >= Low price"
        - name: "open_close_within_range"
          condition: "open >= low AND open <= high AND close >= low AND close <= high"
          error_message: "Open/Close prices must be within High/Low range"
        - name: "price_precision"
          condition: "decimal_places <= 5"
          error_message: "Price precision exceeds 5 decimal places"
    
    price_movement_limits:
      rule_id: "MD002"
      description: "Abnormal price movement detection"
      severity: "HIGH"
      thresholds:
        # Maximum allowed price movement per timeframe
        M1: 0.5  # 0.5% max movement per minute
        M5: 1.0  # 1.0% max movement per 5 minutes
        M15: 2.0 # 2.0% max movement per 15 minutes
        H1: 5.0  # 5.0% max movement per hour
        H4: 10.0 # 10.0% max movement per 4 hours
      action: "FLAG_FOR_REVIEW"
    
    spread_validation:
      rule_id: "MD003"
      description: "Bid-Ask spread validation for scalping"
      severity: "HIGH"
      max_spread_pips:
        EURUSD: 3.0
        GBPUSD: 4.0
        USDJPY: 3.0
        USDCHF: 4.0
        AUDUSD: 4.0
        USDCAD: 4.0
        NZDUSD: 5.0
      action: "REJECT_TICK"

  volume_validation:
    rule_id: "MD004"
    description: "Volume data validation"
    severity: "MEDIUM"
    checks:
      - name: "non_negative_volume"
        condition: "volume >= 0"
        error_message: "Volume cannot be negative"
      - name: "volume_spike_detection"
        condition: "volume <= avg_volume * 10"
        error_message: "Volume spike exceeds 10x average"

  timestamp_validation:
    rule_id: "MD005"
    description: "Timestamp integrity for real-time data"
    severity: "CRITICAL"
    checks:
      - name: "chronological_order"
        condition: "timestamp > previous_timestamp"
        error_message: "Timestamps must be in chronological order"
      - name: "future_timestamp"
        condition: "timestamp <= current_time + 60"
        error_message: "Timestamp cannot be more than 60 seconds in future"
      - name: "market_hours"
        condition: "within_trading_session(timestamp)"
        error_message: "Data outside trading session hours"

# =============================================================================
# TRADING DATA VALIDATION RULES - FINANCIAL INTEGRITY
# =============================================================================

trading_data:
  order_validation:
    rule_id: "TD001"
    description: "Order data integrity validation"
    severity: "CRITICAL"
    checks:
      - name: "order_size_limits"
        condition: "lot_size >= 0.01 AND lot_size <= 100"
        error_message: "Order size must be between 0.01 and 100 lots"
      - name: "price_validity"
        condition: "price > 0"
        error_message: "Order price must be positive"
      - name: "stop_loss_validity"
        condition: "stop_loss != entry_price"
        error_message: "Stop loss cannot equal entry price"
      - name: "take_profit_validity"
        condition: "take_profit != entry_price"
        error_message: "Take profit cannot equal entry price"

  position_validation:
    rule_id: "TD002"
    description: "Position data consistency"
    severity: "CRITICAL"
    checks:
      - name: "position_size_consistency"
        condition: "abs(position_size) == sum(order_sizes)"
        error_message: "Position size must equal sum of order sizes"
      - name: "pnl_calculation"
        condition: "calculated_pnl == actual_pnl"
        tolerance: 0.01
        error_message: "P&L calculation mismatch"
      - name: "margin_requirements"
        condition: "used_margin <= available_margin"
        error_message: "Insufficient margin for position"

  account_validation:
    rule_id: "TD003"
    description: "Account balance and equity validation"
    severity: "CRITICAL"
    checks:
      - name: "balance_consistency"
        condition: "balance >= 0"
        error_message: "Account balance cannot be negative"
      - name: "equity_calculation"
        condition: "equity == balance + unrealized_pnl"
        tolerance: 0.01
        error_message: "Equity calculation error"
      - name: "margin_level"
        condition: "margin_level >= 20"
        error_message: "Margin level below minimum threshold"

# =============================================================================
# TECHNICAL INDICATOR VALIDATION RULES
# =============================================================================

technical_indicators:
  moving_averages:
    rule_id: "TI001"
    description: "Moving average calculation validation"
    severity: "MEDIUM"
    checks:
      - name: "ma_range_check"
        condition: "ma_value >= min_price AND ma_value <= max_price"
        error_message: "Moving average outside reasonable price range"
      - name: "ma_smoothness"
        condition: "abs(ma_current - ma_previous) <= max_change_threshold"
        error_message: "Moving average change too abrupt"

  oscillators:
    rule_id: "TI002"
    description: "Oscillator indicator validation"
    severity: "MEDIUM"
    checks:
      - name: "rsi_bounds"
        condition: "rsi >= 0 AND rsi <= 100"
        error_message: "RSI value outside 0-100 range"
      - name: "stochastic_bounds"
        condition: "stoch_k >= 0 AND stoch_k <= 100 AND stoch_d >= 0 AND stoch_d <= 100"
        error_message: "Stochastic values outside 0-100 range"

# =============================================================================
# DATA COMPLETENESS RULES
# =============================================================================

completeness:
  required_fields:
    rule_id: "DC001"
    description: "Required field validation"
    severity: "CRITICAL"
    market_data_required:
      - timestamp
      - symbol
      - open
      - high
      - low
      - close
      - volume
    trading_data_required:
      - order_id
      - symbol
      - order_type
      - quantity
      - price
      - timestamp
      - account_id

  data_freshness:
    rule_id: "DC002"
    description: "Data freshness validation for real-time trading"
    severity: "HIGH"
    max_age_seconds:
      M1: 60    # 1 minute data max 60 seconds old
      M5: 300   # 5 minute data max 5 minutes old
      M15: 900  # 15 minute data max 15 minutes old
      H1: 3600  # 1 hour data max 1 hour old
      H4: 14400 # 4 hour data max 4 hours old

# =============================================================================
# ANOMALY DETECTION THRESHOLDS
# =============================================================================

anomaly_detection:
  statistical_thresholds:
    rule_id: "AD001"
    description: "Statistical anomaly detection"
    severity: "MEDIUM"
    z_score_threshold: 3.0
    iqr_multiplier: 1.5
    
  pattern_anomalies:
    rule_id: "AD002"
    description: "Pattern-based anomaly detection"
    severity: "MEDIUM"
    checks:
      - name: "gap_detection"
        threshold: 0.5  # 0.5% gap threshold
      - name: "spike_detection"
        threshold: 2.0  # 2 standard deviations
      - name: "volume_anomaly"
        threshold: 5.0  # 5x average volume

# =============================================================================
# ALERT CONFIGURATION
# =============================================================================

alerts:
  notification_channels:
    - type: "email"
      recipients: ["admin@platform3.com", "data-team@platform3.com"]
      severity_levels: ["CRITICAL", "HIGH"]
    - type: "slack"
      webhook_url: "${SLACK_WEBHOOK_URL}"
      severity_levels: ["CRITICAL", "HIGH", "MEDIUM"]
    - type: "database"
      table: "data_quality_alerts"
      severity_levels: ["CRITICAL", "HIGH", "MEDIUM", "LOW"]

  escalation_rules:
    CRITICAL:
      immediate_notification: true
      auto_stop_trading: true
      max_response_time: 300  # 5 minutes
    HIGH:
      immediate_notification: true
      auto_stop_trading: false
      max_response_time: 900  # 15 minutes
    MEDIUM:
      immediate_notification: false
      batch_notification: true
      max_response_time: 3600  # 1 hour
    LOW:
      immediate_notification: false
      batch_notification: true
      max_response_time: 86400  # 24 hours

# =============================================================================
# REMEDIATION ACTIONS
# =============================================================================

remediation:
  auto_fix_rules:
    - rule_id: "MD001"
      action: "interpolate_missing_values"
      conditions: ["missing_data_percentage < 5"]
    - rule_id: "MD002"
      action: "flag_and_quarantine"
      conditions: ["price_movement > threshold"]
    - rule_id: "TD001"
      action: "reject_order"
      conditions: ["validation_failed"]

  manual_review_triggers:
    - "data_quality_score < 0.95"
    - "critical_alerts > 5 per hour"
    - "anomaly_detection_score > 0.8"

# =============================================================================
# MONITORING AND REPORTING
# =============================================================================

monitoring:
  metrics:
    - name: "data_quality_score"
      calculation: "passed_rules / total_rules"
      target: 0.99
    - name: "data_freshness_score"
      calculation: "fresh_records / total_records"
      target: 0.98
    - name: "anomaly_rate"
      calculation: "anomalies_detected / total_records"
      target: 0.01

  reporting:
    daily_report:
      enabled: true
      recipients: ["data-team@platform3.com"]
      metrics: ["data_quality_score", "data_freshness_score", "anomaly_rate"]
    
    weekly_report:
      enabled: true
      recipients: ["management@platform3.com"]
      include_trends: true
      include_recommendations: true
